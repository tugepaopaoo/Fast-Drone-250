# 仿真程序快速开始

启动px4仿真环境，包括mavros及gazebo

```
roslaunch px4 mavros_obs_sitl.launch
```

说明：mavros_obs_sitl.launch这个程序不是px4自带的，我稍微修改添加了一些，如下所示

```
<arg name="sdf" default="$(find mavlink_sitl_gazebo)/models/$(arg vehicle)/$(arg vehicle).sdf"/>

替换为

<arg name="sdf" default="$(find mavlink_sitl_gazebo)/models/iris_depth_camera/iris_depth_camera.sdf"/>
```


启动规划、建图程序，需要在当前程序工作空间内

```
source devel/setup.bash
roslaunch ego_planner single_run_in_exp.launch
```

启动px4ctrl控制模块，用于将控制命令发送给飞控

```
source  devel/setup.bash
roslaunch px4ctrl run_ctrl.launch
```

**说明：** 仿真时，可以用别人修改过的px4ctrl程序，通过动态调参界面实现offboard模式的切换。

还需要打开qgc地面站软件，实现飞行状态的检测和控制起飞、降落。看到有人说，修改过的px4ctrl程序，需要先控制飞行飞起来悬停后，才能切换到offboard模式。

如果IMU频率不够，可以在开启mavros后，新打开一个终端，在其中输入命令

```
    # 10000是指间隔10000us，即0.1s
    # 10000是将频率提到到100hz，若改成5000是提到到200hz
	rosrun mavros mavcmd long 511 31 10000 0 0 0 0 0 & sleep 1;
	rosrun mavros mavcmd long 511 32 10000 0 0 0 0 0 & sleep 1;
```